import asyncio
from aiogram import Bot, Dispatcher

from config import TELEGRAM_TOKEN
from handlers import routers
from middlewares import middlewares
import db
import scheduler

# TODO: –ù–∞ –∫–æ–º–∞–Ω–¥–µ '–∫—Ç–æ [—è|—Ç—ã]' –≥—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–º–µ–µ—Ç –±–∞–≥–∏ –≤–∏–∑—É–∞–ª–∏–∞—Ü–∏–∏(—Å–º. –¥–∞—Ç—ã) (bug_report.jpg)
# TODO: –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–ª—é—á–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏. –ù–∞–ø—Ä–∏–º–µ—Ä –†–ü –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ —Ü–∏—Ç–∞—Ç—ã.

# TODO: –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å /start –∏ /help –∫–æ–º–∞–Ω–¥—ã
# TODO: –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã —á–∏—Å—Ç–æ–∫ —á—Ç–æ–±—ã –ø—Ä–∏–¥–µ–ª–∞—Ç—å –∫–Ω–æ–ø–∫—É —Ç–∏–ø–æ –≤—ã–¥–∞—Ç—å –≤–∞—Ä–Ω—ã
# TODO: –û–±–Ω–æ–≤–∏—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –†–ü –∫–æ–º–∞–Ω–¥—ã —á—Ç–æ–±—ã —Ä–∞–∑–¥–µ–ª—è—Ç—å —á–µ—Ä–µ–∑ –Ω—å—é–ª–∞–π–Ω, –∞ –Ω–µ —á–µ—Ä–µ–∑ —Å–ª—ç—à–∏
# TODO: –°–º–µ–Ω–∞/–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª–∞ (.–º–æ–π–ø–æ–ª –º/–∂) -- –ø–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –≤ –†–ü –∏ –ø—Ä–æ—á–∏—Ö –∫–æ–º–∞–Ω–¥–∞—Ö
# TODO: 15 –ª–∏—á–Ω—ã—Ö –†–ü –∫–æ–º–∞–Ω–¥ –Ω–∞ —á–∞—Ç –≤–º–µ—Å—Ç–æ 3-—Ö
# TODO: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–∏—á–Ω—ã–µ –†–ü –∫–æ–º–∞–Ω–¥—ã
# TODO: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –†–ü –∫–æ–º–∞–Ω–¥ –≤ –¥—Ä—É–≥–æ–π —á–∞—Ç
# TODO: –ò–≥–Ω–æ—Ä-–ª–∏—Å—Ç –¥–ª—è –†–ü/–∏–ª–∏ –ø—Ä–æ—á–∏—Ö –∫–æ–º–∞–Ω–¥
# TODO: –†–µ—Å—Ç–Ω–∏–∫–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Å–æ–∑—ã–≤–µ
# TODO: –Ω–æ–≤—ã–µ —Ä–ø –∫–æ–º–∞–Ω–¥—ã:
"""
–æ—Ç–ª–∏–∑–∞—Ç—åüëÖ ‚Üí {user} –æ—Ç–ª–∏–∑–∞–ª(–∞) —É {target}
–∫—É—Å—å üí¢ ‚Üí {user} —É–∫—É—Å–∏–ª(–∞) {target}
–ø–Ω—É—Ç—å üëû ‚Üí {user} –ø–Ω—É–ª(–∞) –ø–æ–¥–∂–æ–ø–Ω–∏–∫–∞ {target}
–ø–æ—â–µ–∫–æ—Ç–∞—Ç—å üôå ‚Üí {user} –ø–æ—â–µ–∫–æ—Ç–∞–ª(–∞) {target}
–∑–∞–ª–µ–∑—Ç—å üëô ‚Üí {user} –∑–∞–ª–µ–∑(–ª–∞) –≤ —Ç—Ä—É—Å–∏–∫–∏ –∫ {target}
—Å–µ—Å—Ç—å üòà ‚Üí {user} —Å–µ–ª(–∞) –Ω–∞ –ª–∏—Ü–æ {target}
–ª–∞–ø ü´¥ ‚Üí {user} –ø–æ–ª–∞–ø–∞–ª(–∞) {target} –∑–∞ –∏–Ω—Ç–∏–º–Ω—ã–µ –º–µ—Å—Ç–∞
—É–µ–±–∞—Ç—å üí• ‚Üí {user} —É–µ–±–∞–ª(–∞) {target}
–≤–º–∞–∑–∞—Ç—å ü•ä ‚Üí {user} –≤–º–∞–∑–∞–ª(–∞) {target}
–≤—Ç–∞—â–∏—Ç—å ü•ä ‚Üí {user} –≤—Ç–∞—â–∏–ª(–∞) {target}
—Ç–æ–ª–∫–Ω—É—Ç—å ü´≥ ‚Üí {user} —Ç–æ–ª–∫–Ω—É–ª(–∞) {target}
—à–≤—ã—Ä–Ω—É—Ç—å üí´ ‚Üí {user} —à–≤—ã—Ä–Ω—É–ª(–∞) {target}
—Ñ–ª–∏—Ä—Ç–æ–≤–∞—Ç—å üòè ‚Üí {user} —Ñ–ª–∏—Ä—Ç—É–µ—Ç —Å {target}
—Ä–∞–∑–¥–µ—Ç—å üëó ‚Üí {user} —Å—Ç—Ä–∞—Å—Ç–Ω–æ —Å–æ—Ä–≤–∞–ª(–∞) –æ–¥–µ–∂–¥—É —Å {target}
–æ—Ç—ã–º–µ—Ç—å üòàüí¶ ‚Üí {user} –æ—Ç—ã–º–µ–ª(–∞) {target} –∫–∞–∫ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—É—á–∫—É
–≤—ã–ª–∏–∑–∞—Ç—å üëÖüí¶ ‚Üí {user} –≤—ã–ª–∏–∑–∞–ª(–∞) {target} –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–∞–ø–ª–∏
–ø–æ–∂–∞—Ç—å —Ä—É–∫—É ü§ù ‚Üí {user} –∫—Ä–µ–ø–∫–æ –ø–æ–∂–∞–ª(–∞) —Ä—É–∫—É {target}
–¥–∞—Ç—å –ø—è—Ç—å üñê ‚Üí {user} –¥–∞–ª(–∞) –ø—è—Ç—å {target}
–ø–æ–∫–ª–æ–Ω–∏—Ç—å—Å—è üôá ‚Üí {user} —É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∫–ª–æ–Ω–∏–ª—Å—è(–∞) {target}
—É—Å–ø–æ–∫–æ–∏—Ç—å ü§≤ ‚Üí {user} –Ω–µ–∂–Ω–æ —É—Å–ø–æ–∫–æ–∏–ª(–∞) {target}
""" 

dp = Dispatcher()
bot = Bot(token=TELEGRAM_TOKEN)


async def main():
    # —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä—ã –∏ –º–∏–¥–ª–≤–∞—Ä–∏
    for router in routers:
        dp.include_router(router)
    for middleware in middlewares:
        dp.message.middleware(middleware)

    await db.init_db()
    scheduler.start(bot)
    try:
        print("ü§ñ Bot started...")
        await dp.start_polling(bot,
                    allowed_updates=dp.resolve_used_update_types(),
        )
    finally:
        await db.close_db()

if __name__ == "__main__":
    asyncio.run(main())
