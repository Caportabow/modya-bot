import asyncio
from aiogram import Bot, Dispatcher

from config import TELEGRAM_TOKEN
from routers import routers
from middlewares import middlewares
import db
from services import scheduler

# –ë–∞–≥–∏/—Å—Ä–æ—á–Ω–æ–µ:
# TODO: —Å–¥–µ–ª–∞—Ç—å –∫–æ–º–∞–Ω–¥—É —á—Ç–æ–±—ã –ø–æ–ø—Ä–æ—Å–∏—Ç—å —É–¥–æ—á–µ—Ä–∏—Ç—å/—É—Å—ã–Ω–æ–≤–∏—Ç—å —Å–µ–±—è
# TODO: "—Å–æ–±—Ä–∞—Ç—å—Å—è" —Ç–æ–∂–µ –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–æ–∑—ã–≤
# TODO: –∫–∞–ª–ª –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å caption
# TODO: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç —Å–æ–∑—ã–≤–∞
# TODO: —Ä–µ—Å—Ç–Ω–∏–∫–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã —É—á–∞–≤—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Å–æ–∑—ã–≤–∞—Ö
# TODO: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–∫–∞–∑–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É —Ä–µ—Å—Ç–∞
# TODO: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑–≤–æ–¥–∞ –∏ –ø–æ–¥–æ–±–Ω–æ–≥–æ
# TODO: —Å–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —á–∞—Ç–µ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ https://chatgpt.com/share/6971d294-ad78-8010-bacf-42b744451650
# TODO: —Ö–∞–Ω–¥–ª–∏—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏—é –≤ —Å—É–ø–µ—Ä–≥—Ä—É–ø–ø—É
# TODO: —Å–¥–µ–ª–∞—Ç—å —Ç–µ–∫—Å—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –±–æ–ª–µ–µ –µ–¥–∏–Ω—ã–º ++ —Å–¥–µ–ª–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ –¥–æ–∫—Å—Ç—Ä–∏–Ω–≥–∏ –≤–µ–∑–¥–µ
# TODO: –ö–æ–º–∞–Ω–¥–∞ -—á–∞—Ç
# TODO: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞—Ç—å, —Å–ø—É—Å—Ç—è –∫–∞–∫–æ–µ –≤—Ä–µ–º—è —Ä–µ—Å—Ç–Ω–∏–∫–∏ –±—É–¥—É—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —á–∏—Å—Ç–∫–µ
# TODO: –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∞–≤—Ç–æ—á–∏—Å—Ç–∫–∞ –º–æ–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —Å–æ–æ –±—É–¥–µ—Ç –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–æ—Ä–º—ã
# TODO: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–æ–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ +—Ä–æ–ª—å, –∞ –ø–æ—Ç–æ–º –≤—ã–≤–æ–¥–∏—Ç—å –≤ –∫—Ç–æ —è/—Ç—ã –∏–ª–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ ++++ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å —Å–¥–µ–ª–∞—Ç—å –∫–∞–ª–ª –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–æ–ª–∏
# TODO: –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å /start –∏ /help –∫–æ–º–∞–Ω–¥—ã (/help -> –∫–æ–º–∞–Ω–¥–∞ "–∫–æ–º–∞–Ω–¥—ã" —Å –∏–Ω–ª–∞–π–Ω –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π ++ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ –∏–Ω–ª–∞–π–Ω –∑–∞–ø—Ä–æ—Å)
# TODO: —Ä–æ–¥–∏—Ç–µ–ª–∏ –æ–¥–∏–Ω–æ—á–∫–∏
# TODO: —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ –Ω–∏–∫–∏ + —Ç–≥ –Ω–∏–∫–∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Ö –≤ —Ç–≥
# TODO: –û—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç datetime –≤ –ø–æ–ª—å–∑—É –≤—Ä–µ–º–µ–Ω–∏ –≤ –î–ë
# TODO: –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–ª—é—á–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏. –ù–∞–ø—Ä–∏–º–µ—Ä –†–ü –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ —Ü–∏—Ç–∞—Ç—ã.

dp = Dispatcher()
bot = Bot(token=TELEGRAM_TOKEN)


async def main():
    # —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä—ã –∏ –º–∏–¥–ª–≤–∞—Ä–∏
    for router in routers:
        dp.include_router(router)
    for middleware in middlewares:
        dp.message.middleware(middleware)

    await db.init_db()
    scheduler.start(bot)
    try:
        print("ü§ñ Bot started...")
        await dp.start_polling(bot,
                    allowed_updates=dp.resolve_used_update_types(),
        )
    finally:
        await db.close_db()

if __name__ == "__main__":
    asyncio.run(main())
