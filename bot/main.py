import asyncio
from aiogram import Bot, Dispatcher

from config import TELEGRAM_TOKEN
from routers import routers
from middlewares import middlewares
import db
import scheduler

# DONE: 8 –Ω–æ–≤—ã—Ö –†–ü –∫–æ–º–∞–Ω–¥. –£–ª—É—á—à–µ–Ω –≥—Ä–∞—Ñ–∏–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –ò–∑–º–µ–Ω–µ–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ–º–∞–Ω–¥—ã +–º—Ä–ø (+–º—Ä–ø {–∫–æ–º–∞–Ω–¥–∞} / {—ç–º–æ–¥–∑–∏} / {–¥–µ–π—Å—Ç–≤–∏–µ} -> +–º—Ä–ø {–∫–æ–º–∞–Ω–¥–∞} {enter} {—ç–º–æ–¥–∑–∏} {enter} {–¥–µ–π—Å—Ç–≤–∏–µ}). –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å 15 –ª–∏—á–Ω—ã—Ö –†–ü –∫–æ–º–∞–Ω–¥ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —á–∞—Ç–µ –≤–º–µ—Å—Ç–æ 3-—Ö. –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ - –º—Ä–ø —Å–ø–∏—Å–æ–∫: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –ª–∏—á–Ω—ã–µ –†–ü –∫–æ–º–∞–Ω–¥—ã. –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ - –º—Ä–ø —ç–∫—Å–ø–æ—Ä—Ç: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –†–ü –∫–æ–º–∞–Ω–¥—ã –≤ –¥—Ä—É–≥–æ–π —á–∞—Ç.

# TODO: –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–ª—é—á–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏. –ù–∞–ø—Ä–∏–º–µ—Ä –†–ü –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ —Ü–∏—Ç–∞—Ç—ã.
# TODO: –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å /start –∏ /help –∫–æ–º–∞–Ω–¥—ã
# TODO: –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã —á–∏—Å—Ç–æ–∫ —á—Ç–æ–±—ã –ø—Ä–∏–¥–µ–ª–∞—Ç—å –∫–Ω–æ–ø–∫—É –≤—ã–¥–∞—Ç—å –≤–∞—Ä–Ω—ã
# TODO: –ò–≥–Ω–æ—Ä-–ª–∏—Å—Ç –¥–ª—è –†–ü/–∏–ª–∏ –ø—Ä–æ—á–∏—Ö –∫–æ–º–∞–Ω–¥

dp = Dispatcher()
bot = Bot(token=TELEGRAM_TOKEN)


async def main():
    # —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä—ã –∏ –º–∏–¥–ª–≤–∞—Ä–∏
    for router in routers:
        dp.include_router(router)
    for middleware in middlewares:
        dp.message.middleware(middleware)

    await db.init_db()
    scheduler.start(bot)
    try:
        print("ü§ñ Bot started...")
        await dp.start_polling(bot,
                    allowed_updates=dp.resolve_used_update_types(),
        )
    finally:
        await db.close_db()

if __name__ == "__main__":
    asyncio.run(main())
