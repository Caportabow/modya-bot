import asyncio
from aiogram import Bot, Dispatcher

from config import TELEGRAM_TOKEN
from handlers import routers
from middlewares import middlewares
import db
import scheduler

# DONE: 15 –Ω–æ–≤—ã—Ö –†–ü –∫–æ–º–∞–Ω–¥. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥, –∫–æ–≥–¥–∞ –≤–º–µ—Å—Ç–æ –Ω–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–æ—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª—Å—è –µ–≥–æ –Ω–∏–∫ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º–µ. –†–µ—Å—Ç —Ç–µ–ø–µ—Ä—å —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–µ, –≤—ã–¥–∞–≤—à–µ–º —Ä–µ—Å—Ç –∏ –¥–∞—Ç–µ –≤—ã–¥–∞—á–∏. –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –º–æ–π —Ä–µ—Å—Ç –∏ —Ä–µ—Å—Ç {—É–ø–æ–º–∏–Ω–∞–Ω–∏–µ}, –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —Ä–µ—Å—Ç–µ.
# TODO: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª—è—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–ø –∫–æ–º–∞–Ω–¥—ã +–ú—Ä–ø [–Ω–∞–∑–≤–∞–Ω–∏–µ] / [—ç–º–æ–¥–∑–∏] / [—Ç–µ–∫—Å—Ç –¥–µ–π—Å—Ç–≤–∏—è]. –ù–∞–ø—Ä–∏–º–µ—Ä: +–º—Ä–ø –ø–æ–∫–∞–∑–∞—Ç—å —è–∑—ã–∫ /üòõ/ –ø–æ–∫–∞–∑–∞–ª —è–∑—ã–∫.
# TODO: –∏–Ω—Ñ–∞, –∫—Ç–æ, –≤—ã–±–µ—Ä–∏ 
# TODO: utils.texts –¥–ª—è –∑–∞–≥–æ—Ç–æ–≤–æ–∫ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ö—Ä–µ–Ω–æ—Ç–µ–Ω–µ–π
# TODO: –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã: –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ -- /qs —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ª—é–±–æ–π —Å—Ç–∏–∫ –≤ —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø—ã. –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ -- /qd, —á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å —Ü–∏—Ç–∞—Ç—É –∏–∑ —Å–ø–∏—Å–∫–∞ –≥—Ä—É–ø–ø—ã

dp = Dispatcher()
bot = Bot(token=TELEGRAM_TOKEN)


async def main():
    # —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä—ã –∏ –º–∏–¥–ª–≤–∞—Ä–∏
    for router in routers:
        dp.include_router(router)
    for middleware in middlewares:
        dp.message.middleware(middleware)

    await db.init_db()
    scheduler.start(bot)
    try:
        print("ü§ñ Bot started...")
        await dp.start_polling(bot,
                    allowed_updates=dp.resolve_used_update_types(),
        )
    finally:
        await db.close_db()

if __name__ == "__main__":
    asyncio.run(main())
