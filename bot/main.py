import asyncio
from aiogram import Bot, Dispatcher

from config import TELEGRAM_TOKEN
from routers import routers
from middlewares import middlewares
import db
import scheduler

# TODO: –°–µ–π—á–∞—Å –±–æ—Ç –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–æ–ø–∏–∫–æ–≤/—Ñ–æ—Ä—É–º–æ–≤
# TODO: –≤ —Å–µ–º–µ–π–Ω–æ–º –¥—Ä–µ–≤–µ –Ω–µ –ø–∏—Å–∞—Ç—å —Å—ã–Ω –¥–æ—á—å –µ—Å–ª–∏ –º—ã –¥–µ–ª–∞–µ–º –≤–µ—Ç–∫—É —Å –∏–Ω—Ü–µ—Å—Ç–æ–º
# TODO: –≤ —Å–µ–º–µ–π–Ω–æ–º –¥—Ä–µ–≤–µ –∫—É—á–∞ –±–∞–≥–æ–≤ –≤ –≤–µ—Ç–∫–µ —Å –∏–Ω—Ü–µ—Å—Ç–æ–º
# TODO: –≤ whoami –º–µ–Ω—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ –∏–Ω–ª–∞–π–Ω –∫–Ω–æ–ø–∫–∞–º –∞ –Ω–µ –∫–∏–¥–∞—Ç—å –Ω–æ–≤–æ–µ
# TODO: —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ –Ω–∏–∫–∏ + —Ç–≥ –Ω–∏–∫–∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–æ –º–µ—Ä–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Ö –≤ —Ç–≥
# TODO: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞—Ç—å, —Å–ø—É—Å—Ç—è –∫–∞–∫–æ–µ –≤—Ä–µ–º—è —Ä–µ—Å—Ç–Ω–∏–∫–∏ –±—É–¥—É—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —á–∏—Å—Ç–∫–µ
# TODO: —Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞–∑ –≤ —Å–∫–æ–ª—å–∫–æ –Ω–µ–¥–µ–ª—å –¥–µ–ª–∞—Ç—å —á–∏—Å—Ç–∫—É (–∞–≤—Ç–æ—á–∏—Å—Ç–∫–∞)
# TODO: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–æ–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ +—Ä–æ–ª—å, –∞ –ø–æ—Ç–æ–º –≤—ã–≤–æ–¥–∏—Ç—å –≤ –∫—Ç–æ —è/—Ç—ã –∏–ª–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ ++++ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å —Å–¥–µ–ª–∞—Ç—å –∫–∞–ª–ª –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–æ–ª–∏
# TODO: –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∞–≤—Ç–æ—á–∏—Å—Ç–∫–∞ –º–æ–∂–Ω–æ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å —Å–∫–æ–ª—å–∫–æ —Å–æ–æ –±—É–¥–µ—Ç –∫ –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–æ—Ä–º—ã
# TODO: –û—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç datetime –≤ –ø–æ–ª—å–∑—É –≤—Ä–µ–º–µ–Ω–∏ –≤ –î–ë
# TODO: –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å /start –∏ /help –∫–æ–º–∞–Ω–¥—ã
# TODO: –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–ª—é—á–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏. –ù–∞–ø—Ä–∏–º–µ—Ä –†–ü –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ —Ü–∏—Ç–∞—Ç—ã.

dp = Dispatcher()
bot = Bot(token=TELEGRAM_TOKEN)


async def main():
    # —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä—ã –∏ –º–∏–¥–ª–≤–∞—Ä–∏
    for router in routers:
        dp.include_router(router)
    for middleware in middlewares:
        dp.message.middleware(middleware)

    await db.init_db()
    scheduler.start(bot)
    try:
        print("ü§ñ Bot started...")
        await dp.start_polling(bot,
                    allowed_updates=dp.resolve_used_update_types(),
        )
    finally:
        await db.close_db()

if __name__ == "__main__":
    asyncio.run(main())
